{% extends "layout.html" %}

{% block title %}SUBMIT_FEEDBACK{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto border-2 border-white bg-black bg-opacity-90 p-8">
    <div class="border-b-2 border-white pb-4 mb-6">
        <h2 class="text-3xl font-bold uppercase tracking-widest">CANDIDATE EVALUATION</h2>
        <p class="text-xs uppercase opacity-50 mt-2">
            {% if existing_feedback %}
                UPDATING EXISTING FEEDBACK
            {% else %}
                SUBMIT NEW FEEDBACK
            {% endif %}
        </p>
    </div>
    
    <div class="mb-8 p-4 border border-white bg-white bg-opacity-5">
        <div class="grid grid-cols-2 gap-4 text-sm uppercase">
            <div>
                <span class="opacity-70">CANDIDATE:</span>
                <span class="font-bold text-white block mt-1">{{ interview.candidate }}</span>
            </div>
            <div>
                <span class="opacity-70">POSITION:</span>
                <span class="font-bold text-white block mt-1">{{ interview.job }}</span>
            </div>
            <div>
                <span class="opacity-70">INTERVIEW DATE:</span>
                <span class="font-bold text-white block mt-1">{{ interview.interview_date }}</span>
            </div>
            <div>
                <span class="opacity-70">INTERVIEW MODE:</span>
                <span class="font-bold text-white block mt-1">{{ interview.interview_mode }}</span>
            </div>
        </div>
    </div>

    <form action="{{ url_for('recruiter_give_feedback', interview_id=interview.interview_id) }}" method="POST" class="space-y-8">
        
        <!-- Rating Section -->
        <div class="border border-white p-6">
            <label class="text-lg font-bold uppercase tracking-wider mb-4 block">PERFORMANCE RATING *</label>
            <p class="text-xs opacity-70 mb-4">Rate the candidate's performance from 1 (Poor) to 10 (Excellent)</p>
            
            <div class="flex justify-between gap-2">
                {% for i in range(1, 11) %}
                <label class="flex-1 cursor-pointer">
                    <input type="radio" name="rating" value="{{ i }}" required 
                           {% if existing_feedback and existing_feedback.rating == i %}checked{% endif %}
                           class="hidden peer">
                    <div class="h-16 flex flex-col items-center justify-center border-2 border-white text-center transition-all 
                                peer-checked:bg-white peer-checked:text-black peer-checked:font-bold
                                hover:bg-white hover:text-black hover:scale-105">
                        <span class="text-2xl font-bold">{{ i }}</span>
                        <span class="text-xs mt-1">
                            {% if i <= 3 %}POOR
                            {% elif i <= 5 %}FAIR
                            {% elif i <= 7 %}GOOD
                            {% elif i <= 9 %}GREAT
                            {% else %}EXCELLENT{% endif %}
                        </span>
                    </div>
                </label>
                {% endfor %}
            </div>
        </div>

        <!-- Comments Section -->
        <div class="border border-white p-6">
            <label class="text-lg font-bold uppercase tracking-wider mb-4 block">DETAILED EVALUATION *</label>
            <p class="text-xs opacity-70 mb-4">Provide comprehensive feedback on the candidate's performance, skills, and fit for the role</p>
            <textarea name="comments" rows="8" required 
                      class="w-full p-4 bg-black border-2 border-white text-white placeholder-gray-500 focus:border-white focus:ring-0" 
                      placeholder="ENTER DETAILED OBSERVATIONS AND EVALUATION NOTES...">{% if existing_feedback %}{{ existing_feedback.comments }}{% endif %}</textarea>
            <p class="text-xs opacity-50 mt-2">Include: Technical skills, communication, problem-solving, cultural fit, etc.</p>
        </div>

        <!-- Final Decision Section -->
        <div class="border-2 border-white p-6 bg-white bg-opacity-5">
            <label class="text-lg font-bold uppercase tracking-wider mb-4 block">FINAL HIRING DECISION *</label>
            <p class="text-xs opacity-70 mb-4">Select the final outcome for this candidate</p>
            
            <div class="grid grid-cols-3 gap-4">
                <label class="cursor-pointer">
                    <input type="radio" name="final_decision" value="Selected" required 
                           {% if interview.app_status == 'Selected' %}checked{% endif %}
                           class="hidden peer">
                    <div class="p-6 border-2 border-white text-center transition-all
                                peer-checked:bg-white peer-checked:text-black peer-checked:border-white
                                hover:bg-white hover:bg-opacity-20">
                        <div class="text-3xl mb-2">✓</div>
                        <div class="font-bold uppercase">SELECTED</div>
                        <div class="text-xs mt-2 opacity-70">Hire this candidate</div>
                    </div>
                </label>
                
                <label class="cursor-pointer">
                    <input type="radio" name="final_decision" value="Shortlisted" 
                           {% if interview.app_status == 'Shortlisted' or not interview.app_status %}checked{% endif %}
                           class="hidden peer">
                    <div class="p-6 border-2 border-white text-center transition-all
                                peer-checked:bg-white peer-checked:text-black peer-checked:border-white
                                hover:bg-white hover:bg-opacity-20">
                        <div class="text-3xl mb-2">⟳</div>
                        <div class="font-bold uppercase">PENDING</div>
                        <div class="text-xs mt-2 opacity-70">Need more evaluation</div>
                    </div>
                </label>
                
                <label class="cursor-pointer">
                    <input type="radio" name="final_decision" value="Rejected" 
                           {% if interview.app_status == 'Rejected' %}checked{% endif %}
                           class="hidden peer">
                    <div class="p-6 border-2 border-white text-center transition-all
                                peer-checked:bg-white peer-checked:text-black peer-checked:border-white
                                hover:bg-white hover:bg-opacity-20">
                        <div class="text-3xl mb-2">✗</div>
                        <div class="font-bold uppercase">REJECTED</div>
                        <div class="text-xs mt-2 opacity-70">Not suitable</div>
                    </div>
                </label>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex gap-4 pt-4">
            <button type="submit" class="flex-1 py-4 bg-white text-black font-bold uppercase tracking-[0.2em] text-lg hover:bg-gray-200 transition-colors">
                {% if existing_feedback %}
                    UPDATE EVALUATION
                {% else %}
                    SUBMIT EVALUATION
                {% endif %}
            </button>
            <a href="{{ url_for('recruiter_interviews') }}" class="px-8 py-4 border-2 border-white font-bold uppercase tracking-widest hover:bg-white hover:text-black transition-colors flex items-center justify-center">
                CANCEL
            </a>
        </div>
    </form>
</div>

<script>
// Form validation
document.querySelector('form').addEventListener('submit', function(e) {
    const rating = document.querySelector('input[name="rating"]:checked');
    const comments = document.querySelector('textarea[name="comments"]').value.trim();
    const decision = document.querySelector('input[name="final_decision"]:checked');
    
    if (!rating) {
        e.preventDefault();
        alert('Please select a rating');
        return;
    }
    
    if (!comments || comments.length < 10) {
        e.preventDefault();
        alert('Please provide detailed feedback (at least 10 characters)');
        return;
    }
    
    if (!decision) {
        e.preventDefault();
        alert('Please select a final decision');
        return;
    }
});
</script>
{% endblock %}